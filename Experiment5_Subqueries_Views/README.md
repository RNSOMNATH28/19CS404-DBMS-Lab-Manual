# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.

```sql
SELECT student_name, grade
FROM GRADES g
WHERE grade = (
    SELECT MAX(grade)
    FROM GRADES
    WHERE subject = g.subject
);
```

**Output:**

<img width="753" height="432" alt="image" src="https://github.com/user-attachments/assets/6d5ff9ee-dbb3-4b0d-aaac-d0bbc0a2a257" />


**Question 2**
---
From the following tables, write a SQL query to find all the orders generated in New York city. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

```sql
SELECT o.ord_no, 
       o.purch_amt, 
       o.ord_date, 
       o.customer_id, 
       o.salesman_id
FROM orders o
JOIN salesman s 
    ON o.salesman_id = s.salesman_id
WHERE s.city = 'New York';

```

**Output:**

<img width="1270" height="492" alt="image" src="https://github.com/user-attachments/assets/9a3ef4e2-ef9a-440f-9a7b-f112b54a5790" />


**Question 3**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi

```sql
SELECT *
FROM CUSTOMERS
WHERE ADDRESS = 'Delhi';

```

**Output:**

<img width="1230" height="328" alt="image" src="https://github.com/user-attachments/assets/bab4ac9b-0ba9-4dbb-8abb-c488a7ffba74" />


**Question 4**
---Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 2.5 Lakh

```sql
SELECT id, name, age, city, income
FROM Employee
WHERE age < (
    SELECT AVG(age)
    FROM Employee
    WHERE income > 250000
);

```

**Output:**

<img width="1268" height="524" alt="image" src="https://github.com/user-attachments/assets/7bc4d05c-9f39-4fbc-b3b2-7c879b5c1f6d" />


**Question 5**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```sql
SELECT o.ord_no, 
       o.purch_amt, 
       o.ord_date, 
       o.customer_id, 
       o.salesman_id
FROM orders o
JOIN salesman s 
    ON o.salesman_id = s.salesman_id
WHERE s.city = 'New York';

```

**Output:**

<img width="1280" height="469" alt="image" src="https://github.com/user-attachments/assets/17028033-3cf5-48ca-ac80-e98146c085e8" />


**Question 6**
---
From the following tables, write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```sql
SELECT ord_no, 
       purch_amt, 
       ord_date, 
       customer_id, 
       salesman_id
FROM orders
WHERE salesman_id IN (
    SELECT salesman_id
    FROM orders
    WHERE customer_id = 3007
);

```

**Output:**

<img width="1280" height="433" alt="image" src="https://github.com/user-attachments/assets/1d67027e-9006-40f4-aa93-b5585811d997" />


**Question 7**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose AGE is LESS than $30

```sql
select* from CUSTOMERS WHERE age<30;
```

**Output:**

<img width="1253" height="577" alt="image" src="https://github.com/user-attachments/assets/c744ea8d-03ea-4bbc-89c3-c28c75a3a22c" />


**Question 8**
---From the following tables, write a SQL query to determine the commission of the salespeople in Paris. Return commission.

```sqlSELECT DISTINCT s.commission
FROM salesman s
WHERE s.salesman_id IN (
    SELECT c.salesman_id
    FROM customer c
    WHERE c.city = 'Paris'
);

```

**Output:**

<img width="409" height="343" alt="image" src="https://github.com/user-attachments/assets/c7e07a82-51f2-4815-b06b-a70b609d04f6" />


**Question 9**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi and age below 30

```sql
select * from CUSTOMERS WHERE ADDRESS='Delhi' AND AGE<30 order by ID asc;
```

**Output:**

<img width="1258" height="360" alt="image" src="https://github.com/user-attachments/assets/3230072b-f566-4295-87a0-ac15b81bdeb4" />

**Question 10**
---
Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject.

```sql
SELECT student_id, 
       student_name, 
       subject, 
       grade
FROM Grades g
WHERE grade = (
    SELECT MAX(grade)
    FROM Grades
    WHERE subject = g.subject
);

```

**Output:**

<img width="1282" height="452" alt="image" src="https://github.com/user-attachments/assets/3dbe9d06-2f04-4d47-a8df-e2f42ba932af" />
## Completion status:

<img width="594" height="161" alt="image" src="https://github.com/user-attachments/assets/71790249-9654-468b-8ce3-3cdd14130efb" />

## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
